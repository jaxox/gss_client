# ‚úÖ Reproducing and Capturing Metro Errors (So Copilot Can Read Them)

## üéØ Goal

React Native's Metro bundler errors were only showing in the red screen / Metro terminal ‚Äî **not in the log file** generated by:

```bash
kill -9 $(lsof -ti:8081) 2>/dev/null; timeout 600 npx react-native run-ios --simulator "iPhone 17 Pro" 2>&1 | tee /tmp/ios_build_react18.log
```

We want Metro errors (JavaScript runtime errors) to be captured in a file inside the project so **GitHub Copilot and other AI tools can read them.**

---

## ‚ùå Why the previous approach didn't work

| Problem                                     | Explanation                                                                                                                                                                        |
| ------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Metro is launched as a **separate process** | `npx react-native run-ios` spawns Metro via macOS Terminal / `launchPackager.command`. It does **not run in the same shell pipeline**, so its output is **not captured by `tee`**. |
| Only native build logs are captured         | The output in `/tmp/ios_build_react18.log` contains the **iOS native build (Xcode) logs only**, not Metro logs.                                                                    |
| Metro doesn't write to file by default      | Unless started manually, Metro's stdout/stderr stays in its own terminal session and never reaches your log file.                                                                  |
| Result ‚Üí Copilot can't "see" the error      | Because the Metro error isn't inside the workspace or file system, Copilot has no access to it. It can only _guess based on missing imports/code_.                                 |

---

## ‚úÖ **CRITICAL: The ONLY Way to Debug React Native Apps**

### üö® **MANDATORY DEBUGGING PROTOCOL** üö®

**This is the ONLY reliable method to capture Metro/JavaScript errors. Follow these steps EXACTLY.**

---

### **Step 1: Start Metro in Terminal 1 (T1) and LET IT RUN**

```bash
cd /Users/wlyu/dev/AI-PROJECT/gss_client/mobile
npm run metro:log
```

**CRITICAL RULES:**

- ‚ùå **DO NOT** interrupt this terminal
- ‚ùå **DO NOT** run any commands after it starts
- ‚ùå **DO NOT** press Ctrl+C
- ‚ùå **DO NOT** run `sleep`, `echo`, or ANY other command in T1
- ‚úÖ **LET IT RUN** continuously ‚Äî this terminal is for Metro ONLY

**What you'll see:**

```
Welcome to React Native v0.82
Starting dev server on http://localhost:8081
INFO  Dev server ready.
```

---

### **Step 2: Start iOS build in Terminal 2 (T2) and LET IT RUN**

Open a **SEPARATE** terminal and run:

```bash
cd /Users/wlyu/dev/AI-PROJECT/gss_client/mobile
npm run ios:no-metro
```

**CRITICAL RULES:**

- ‚ùå **DO NOT** interrupt this terminal
- ‚ùå **DO NOT** run any commands after it starts
- ‚ùå **DO NOT** press Ctrl+C
- ‚ùå **DO NOT** run `sleep`, `echo`, or ANY other command in T2
- ‚úÖ **LET IT RUN** until build completes

**What you'll see:**

```
info Building (using "xcodebuild...")
- Building the app........
```

---

### **Step 3: Watch T1 for JavaScript/Metro Errors**

**When the iOS app launches, T1 will show ANY JavaScript errors.**

Example error you'll see in T1:

```
ERROR  Error: Unable to resolve module react-native-gesture-handler from /mobile/index.js:
react-native-gesture-handler could not be found within the project or in these directories:
  node_modules
```

‚úÖ **This is the REAL error** ‚Äî copy it from T1  
‚úÖ Errors are also saved to `logs/metro-error.log`

---

### **Step 4: Check the Log Files**

After both terminals stabilize:

```bash
# Metro/JavaScript errors
cat mobile/logs/metro-error.log

# iOS native build logs
cat mobile/logs/ios-build.log
```

---

## üõë **Common Mistakes That WILL Fail**

| ‚ùå What NOT to do                        | Why it fails                               |
| ---------------------------------------- | ------------------------------------------ |
| Running both commands in ONE terminal    | Metro spawns separately, logs are lost     |
| Using `&&` or `;` between commands       | Doesn't capture Metro output properly      |
| Running `npm run ios` alone              | Metro output isn't saved to a file         |
| Adding `sleep` or `echo` after commands  | Interrupts the process, breaks log capture |
| Checking logs before both terminals idle | Logs are incomplete                        |

---

## ‚úÖ **Correct npm Scripts (Already in package.json)**

```json
{
  "scripts": {
    "metro:log": "mkdir -p logs && npx react-native start --reset-cache 2>&1 | tee logs/metro-error.log",
    "ios:no-metro": "npx react-native run-ios --no-packager --simulator 'iPhone 17 Pro' 2>&1 | tee logs/ios-build.log"
  }
}
```

---

## ü§ñ **For AI Agents: Critical Debugging Instructions**

When a user reports React Native errors:

1. **NEVER** try to run both commands in one terminal
2. **ALWAYS** start Metro in T1 first: `npm run metro:log`
3. **ALWAYS** start iOS in T2 second: `npm run ios:no-metro`
4. **DO NOT** run ANY other commands in T1 or T2 after starting them
5. **WAIT** for both processes to complete naturally
6. **READ** `logs/metro-error.log` to find JavaScript errors
7. **READ** `logs/ios-build.log` for native build errors

**If you see:** "Unable to resolve module X"
‚Üí The package is missing from `package.json` dependencies

**If you see:** Native build errors
‚Üí Check `ios-build.log` for Xcode-specific issues

---

## üìù Why This Approach Works

| ‚úÖ Benefit                | Explanation                             |
| ------------------------- | --------------------------------------- |
| Metro runs in foreground  | Output is captured by `tee` to log file |
| Logs saved in project     | AI tools can read them via `read_file`  |
| Two terminals = isolation | Metro and iOS build don't interfere     |
| Deterministic             | Same setup every time, reproducible     |
| Complete error context    | Full stack trace with line numbers      |

---

## üéØ Summary

**For humans:**

1. Terminal 1: `npm run metro:log` ‚Üí leave it running
2. Terminal 2: `npm run ios:no-metro` ‚Üí leave it running
3. Watch T1 for JavaScript errors
4. Check `logs/metro-error.log` for saved errors

**For AI agents:**

- Use `run_in_terminal` with `isBackground: true` for BOTH commands
- Wait for both to stabilize
- Read `logs/metro-error.log` to diagnose issues
- Never interrupt or add commands after starting these processes

---

```

```
