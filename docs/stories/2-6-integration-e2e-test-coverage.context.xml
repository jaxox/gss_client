<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>6</storyId>
    <title>Integration & E2E Test Coverage for Event Flows</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-11</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/2-6-integration-e2e-test-coverage.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>development team</asA>
    <iWant>comprehensive integration and end-to-end test coverage for event discovery, RSVP, and check-in flows</iWant>
    <soThat>we can catch regressions early, ensure cross-platform consistency, and maintain confidence in critical user journeys</soThat>
    <tasks>
      - Integration tests for free event RSVP flow (discover → detail → RSVP → My RSVPs)
      - Integration tests for deposit event RSVP flow (discover → detail → payment authorization → RSVP)
      - Integration tests for RSVP management (My RSVPs screen, cancel flow, state updates)
      - Integration tests for private event access (invite token validation, RSVP flow)
      - Mobile E2E tests for event discovery and filtering (list, map, filters, navigation)
      - Mobile E2E tests for free event RSVP flow (discover → detail → RSVP → confirmation)
      - Mobile E2E tests for deposit event RSVP flow (discover → detail → payment → RSVP)
      - Web E2E tests for event discovery and filtering (list, map, filters, navigation)
      - Web E2E tests for free event RSVP flow (discover → detail → RSVP → confirmation)
      - Web E2E tests for deposit event RSVP flow (discover → detail → payment → RSVP)
      - E2E tests for event cancellation flow (cancel RSVP → confirmation → removed from My RSVPs)
      - E2E tests for error scenarios (network failures, capacity conflicts, payment errors)
      - Configure Detox for mobile E2E with test configuration and simulator setup
      - Configure Playwright for web E2E with test configuration and headless browser setup
      - Set up E2E test fixtures (mock events, mock payment methods, test users)
      - Integrate E2E tests into CI/CD pipeline with coverage reporting
      - Document test patterns and establish coverage targets (70% unit, 20% integration, 10% E2E)
    </tasks>
  </story>

  <acceptanceCriteria>
    AC1: Integration Tests for Free Event RSVP Flow - Test complete flow: discover event → view detail → RSVP → confirmation → appears in My RSVPs. Mock EventService and state management, no HTTP calls. Verify state transitions: idle → loading → success with correct event data. Verify optimistic updates: participant count increments immediately. Test error scenarios: network failure, capacity full (409 conflict), invalid event ID. Test rollback on capacity conflict: participant count reverts, error displayed. Test RSVP persistence: state maintained after app restart (Redux persist). Cross-platform: Run identical tests on mobile and web.

    AC2: Integration Tests for Deposit Event RSVP Flow - Test complete flow: discover event with deposit → payment authorization → RSVP → confirmation. Mock PaymentService and Stripe SDK responses. Verify payment method selection and authorization flow. Test authorization success: paymentMethodId attached to RSVP, confirmation displayed. Test payment failures: card declined, insufficient funds, network error. Verify retry functionality after payment failures. Test authorization messaging: "We'll authorize $X" displayed correctly. Verify deposit refund promise messaging on confirmation screen. Cross-platform: Run identical tests on mobile and web.

    AC3: Integration Tests for RSVP Management - Test My RSVPs screen loads with user's RSVPs sorted by date. Verify RSVP card displays: title, date, location, deposit status, check-in status. Test navigation from RSVP card to event detail. Test cancel RSVP flow: confirmation dialog → API call → RSVP removed from list. Test state updates: event detail shows "You're Registered" chip when user has RSVP'd. Test participant count updates after RSVP creation and cancellation. Verify empty state when user has no RSVPs. Cross-platform: Run identical tests on mobile and web.

    AC4: Integration Tests for Private Event Access - Test invite token validation: valid token → event detail displayed. Test invalid token: error message "Invalid or expired invite link" displayed. Test RSVP flow for private events identical to public events. Test token expiration: expired token → error message. Test deep link navigation: gss://event/{id}/invite/{token} opens app and validates token. Cross-platform: Run identical tests on mobile and web.

    AC5: Mobile E2E Tests for Event Discovery and Filtering - Detox tests for complete discovery flow: app launch → navigate to Events tab → see event list. Test list/map toggle: tap map icon → see event markers on map. Test filter interaction: tap filter icon → select sport filter → apply → see filtered events. Test distance filter: change radius slider → see events within radius. Test navigation to detail: tap event card → see event detail screen with correct data. Verify search functionality: enter search text → see matching events. Test empty state when no events match filters.

    AC6: Mobile E2E Tests for Free Event RSVP Flow - Detox tests for complete RSVP flow: navigate to event detail → see event info (title, date, location, capacity) → tap "RSVP" button → see confirmation screen "You're registered!" → navigate to My RSVPs → see newly registered event in list. Verify state persistence: force quit app → reopen → navigate to My RSVPs → event still displayed. Test participant count update: return to event detail → see participant count incremented.

    AC7: Mobile E2E Tests for Deposit Event RSVP Flow - Detox tests for complete deposit RSVP flow: navigate to deposit event detail → see deposit amount $X displayed → tap "RSVP" button → see payment authorization screen → select payment method (mock card) → see "We'll authorize $X" message → tap "Confirm" → see authorization processing → see confirmation "You're registered! We've authorized $X as deposit." → navigate to My RSVPs → see event with deposit badge. Test payment error scenario: select failing mock card → see error "Card declined" → retry with valid card → success.

    AC8: Web E2E Tests for Event Discovery and Filtering - Playwright tests for complete discovery flow: navigate to /events → see event list with cards. Test list/map toggle: click map button → see map view with markers. Test filter interaction: click filter dropdown → select sport → see filtered events. Test distance filter: adjust slider → see events within radius. Test search: type in search box → see matching events. Test navigation: click event card → navigate to /events/:id → see event detail page. Verify filter persistence: apply filters → navigate away → return → filters still applied.

    AC9: Web E2E Tests for Free Event RSVP Flow - Playwright tests for complete RSVP flow: navigate to /events/:id → see event detail page → click "RSVP" button → see confirmation modal "You're registered!" → close modal → see "You're Registered" chip on event detail → navigate to /my-rsvps → see event in list with upcoming status. Test cancel RSVP: click "Cancel RSVP" → see confirmation dialog → click "Yes, Cancel" → RSVP removed from list → return to event detail → "RSVP" button available again.

    AC10: Web E2E Tests for Deposit Event RSVP Flow - Playwright tests for complete deposit RSVP flow: navigate to deposit event detail → see deposit amount $X → click "RSVP" button → see payment authorization modal → select payment method → see "We'll authorize $X as deposit" → click "Confirm Authorization" → see processing spinner → see success modal "You're registered! Deposit authorized." → close modal → see "You're Registered" chip with deposit icon → navigate to /my-rsvps → see event with deposit badge "$X deposit".

    AC11: E2E Tests for Event Cancellation Flow - Test complete cancellation flow: Navigate to My RSVPs → select event with upcoming status → click "Cancel RSVP" → see confirmation dialog "Cancel your RSVP? You'll lose your spot." → click "Yes, Cancel" → see processing → see success "RSVP cancelled" → event removed from list → navigate to event detail → "RSVP" button available, participant count decremented. Test deposit cancellation: Cancel RSVP for deposit event → see warning "Cancelling within cutoff window may forfeit deposit" → confirm → deposit authorization voided → refund not issued. Test outside cutoff: Cancel >24h before event → deposit authorization voided → no penalty message.

    AC12: E2E Tests for Error Scenarios - Test network failure during RSVP: Disconnect network → attempt RSVP → see error "Network error. Check your connection and try again" → reconnect → retry → success. Test capacity conflict: Mock capacity full response (409) → attempt RSVP → see error "Event is full" → return to list → event shows "Full" badge. Test payment authorization failure: Mock card declined → attempt deposit RSVP → see error "Card declined. Please try another payment method" → select different card → retry → success. Test server error (500): Mock server error → attempt RSVP → see error "Something went wrong. Please try again later" → retry button works. Test timeout: Mock slow response (>10s) → attempt RSVP → see loading spinner → see timeout error → retry works.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/tech-spec-epic-2.md</path>
        <title>Epic 2 Technical Specification</title>
        <section>Testing Strategy</section>
        <snippet>Unit tests with Jest (mobile, shared) and Vitest (web). Integration tests with React Testing Library for component integration. E2E tests with Detox (mobile) and Playwright (web). Test pyramid: 70% unit, 20% integration, 10% E2E. Coverage targets: 70% all metrics (branches, functions, lines, statements). Mock service layer for integration tests. E2E tests use real components with mock backend APIs.</snippet>
      </doc>
      <doc>
        <path>docs/knowledge-base/AGENT-TESTING-GUIDE.md</path>
        <title>Agent Testing Guide</title>
        <section>Testing Workflow and CI Flags</section>
        <snippet>Always use CI flags for tests: npm test -- --ci --passWithNoTests --maxWorkers=2 for Jest (mobile, shared). npm test -- --run for Vitest (web). Never let tests hang in watch mode. Report pass/fail counts and specific failures. Test all 3 packages: shared, mobile, web.</snippet>
      </doc>
      <doc>
        <path>docs/knowledge-base/MOBILE-E2E-TESTING-GUIDE.md</path>
        <title>Mobile E2E Testing Guide</title>
        <section>Detox Setup and Execution</section>
        <snippet>Detox requires .detoxrc.js configuration with apps (ios.debug, android.debug) and devices (simulator, emulator). Build app first: npm run test:e2e:build:ios. Run tests: npm run test:e2e:ios. Tests in __tests__/e2e/ or e2e/ directories. Detox uses element matchers: element(by.id('testID')), element(by.text('Label')). Actions: tap(), typeText(), scroll(). Assertions: toBeVisible(), toHaveText(), toExist().</snippet>
      </doc>
      <doc>
        <path>mobile/jest.config.js</path>
        <title>Mobile Jest Configuration</title>
        <section>Coverage Thresholds</section>
        <snippet>Coverage targets: branches 70%, functions 70%, lines 70%, statements 70%. Test files in src/**/__tests__/**/*.test.tsx. E2E tests excluded via testPathIgnorePatterns: /__tests__/e2e/. Setup file: jest.setup.js with mocks for AsyncStorage, GoogleSignIn, React Native modules.</snippet>
      </doc>
      <doc>
        <path>web/vitest.config.ts</path>
        <title>Web Vitest Configuration</title>
        <section>Coverage Thresholds</section>
        <snippet>Coverage targets: branches 70%, functions 70%, lines 70%, statements 70%. Test environment: jsdom for DOM testing. Setup file: src/test/setup.ts. Path aliases: @shared for shared library, @ for web src. Test files: src/**/*.test.tsx.</snippet>
      </doc>
      <doc>
        <path>shared/src/services/mock/mockEvents.service.ts</path>
        <title>Mock Event Service</title>
        <section>Mock Implementation</section>
        <snippet>MockEventService extends EventService with in-memory mock data. Methods: createEvent, getEvent, updateEvent, deleteEvent, searchEvents, getNearbyEvents, getMyEvents, getMyRSVPs, createRSVP, cancelRSVP, getRSVPStatus, checkIn, manualCheckIn. Simulates network delays 500-1500ms. Pre-populated with test events. Reset method for test cleanup.</snippet>
      </doc>
      <doc>
        <path>shared/src/services/mock/mockPayment.service.ts</path>
        <title>Mock Payment Service</title>
        <section>Mock Implementation</section>
        <snippet>MockPaymentService extends PaymentService with mock Stripe responses. Methods: authorizeDeposit, getPaymentMethods, addPaymentMethod, deletePaymentMethod, setDefaultPaymentMethod, getStripeConfig. Pre-populated with test card (Visa 4242). Simulates network delays. Reset method for test cleanup.</snippet>
      </doc>
      <doc>
        <path>docs/stories/2-2-event-rsvp-deposit-authorization.context.xml</path>
        <title>Story 2-2 Context - RSVP Flows</title>
        <section>RSVP Service Integration</section>
        <snippet>EventService.createRSVP(request: RSVPRequest) for free and deposit events. RSVPRequest: { eventId, paymentMethodId? }. PaymentService.authorizeDeposit for deposit authorization. Redux RSVPStore with optimistic updates and rollback. TanStack Query useRSVPMutation hook. Tests verify state transitions and error handling.</snippet>
      </doc>
      <doc>
        <path>docs/stories/2-3-qr-check-in-deposit-refund.context.xml</path>
        <title>Story 2-3 Context - Check-In Tests</title>
        <section>Check-In Testing Patterns</section>
        <snippet>Integration tests for EventService.checkIn() with QR validation. E2E tests with Detox (mobile) and Playwright (web) for complete check-in flow. Mock QR codes with test fixtures. Test deposit refund automation. Verify success animations and state updates. Test error scenarios: invalid QR, already checked in, outside time window.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>shared/src/services/mock/mockEvents.service.ts</path>
        <kind>mock service</kind>
        <symbol>MockEventService</symbol>
        <lines>1-350</lines>
        <reason>Core mock service for integration testing. Implements all EventService methods with in-memory data. Pre-populated test events. Simulates network delays and error scenarios. Used by integration tests to mock backend API responses without HTTP calls.</reason>
      </artifact>
      <artifact>
        <path>shared/src/services/mock/mockPayment.service.ts</path>
        <kind>mock service</kind>
        <symbol>MockPaymentService</symbol>
        <lines>1-150</lines>
        <reason>Mock payment service for deposit RSVP integration tests. Implements authorizeDeposit, getPaymentMethods, addPaymentMethod. Pre-populated with test card (Visa 4242). Simulates Stripe responses and network delays. Used to test deposit authorization flow without real Stripe API.</reason>
      </artifact>
      <artifact>
        <path>mobile/src/screens/events/wizard/__tests__/CreateEventWizard.integration.test.tsx</path>
        <kind>integration test example</kind>
        <symbol>CreateEventWizard integration test</symbol>
        <lines>1-100</lines>
        <reason>Example integration test showing Redux provider wrapping, mock service setup, complete wizard flow testing with state management. Pattern to follow for RSVP flow integration tests: wrap with providers, mock services, simulate user interactions, verify state updates and API calls.</reason>
      </artifact>
      <artifact>
        <path>mobile/jest.config.js</path>
        <kind>test configuration</kind>
        <symbol>Mobile Jest config</symbol>
        <lines>1-60</lines>
        <reason>Mobile test configuration with coverage thresholds (70%), module mapping for @shared, transform patterns, testPathIgnorePatterns for E2E. Setup file jest.setup.js with mocks. Test file patterns: src/**/__tests__/**/*.test.tsx.</reason>
      </artifact>
      <artifact>
        <path>mobile/jest.setup.js</path>
        <kind>test setup</kind>
        <symbol>Mobile Jest setup</symbol>
        <lines>1-150</lines>
        <reason>Jest setup file with mocks for AsyncStorage, GoogleSignIn, React Native modules (Alert, Linking, Share, SafeAreaView), react-native-paper, react-native-vector-icons. Mock console methods to reduce noise. Global test utilities and fetch mock. Required for all mobile tests.</reason>
      </artifact>
      <artifact>
        <path>web/vitest.config.ts</path>
        <kind>test configuration</kind>
        <symbol>Web Vitest config</symbol>
        <lines>1-50</lines>
        <reason>Web test configuration with jsdom environment, coverage thresholds (70%), setup file src/test/setup.ts, path aliases (@shared, @). Test file patterns: src/**/*.test.tsx. Coverage provider: v8 with html/lcov reporters.</reason>
      </artifact>
      <artifact>
        <path>mobile/package.json</path>
        <kind>dependency manifest</kind>
        <symbol>Mobile dependencies</symbol>
        <lines>1-80</lines>
        <reason>Mobile dependencies including testing libraries: @testing-library/react-native@^13.3.3, jest@^29.6.3, detox@^20.45.1, detox-cli@^20.0.0. E2E scripts: test:e2e:ios, test:e2e:build:ios. Test script: jest with --ci --passWithNoTests flags.</reason>
      </artifact>
      <artifact>
        <path>web/package.json</path>
        <kind>dependency manifest</kind>
        <symbol>Web dependencies</symbol>
        <lines>1-60</lines>
        <reason>Web dependencies including testing libraries: @testing-library/react@^16.0.0, @testing-library/jest-dom@^6.0.0, @testing-library/user-event@^14.0.0, vitest@^2.0.0, jsdom@^25.0.0. Test scripts: test (vitest), test:ci (vitest run). Playwright to be added for E2E.</reason>
      </artifact>
    </code>
    <dependencies>
      <shared>
        <dep name="@reduxjs/toolkit" version="^2.10.1" usage="Redux store for state management in integration tests"/>
        <dep name="@tanstack/react-query" version="^5.90.7" usage="Query mutations and cache management in integration tests"/>
      </shared>
      <mobile>
        <dep name="jest" version="^29.6.3" usage="Test runner for unit and integration tests"/>
        <dep name="@testing-library/react-native" version="^13.3.3" usage="React Native Testing Library for component testing"/>
        <dep name="react-test-renderer" version="19.1.1" usage="React renderer for snapshot testing"/>
        <dep name="detox" version="^20.45.1" usage="E2E testing framework for React Native"/>
        <dep name="detox-cli" version="^20.0.0" usage="Detox CLI for running E2E tests"/>
      </mobile>
      <web>
        <dep name="vitest" version="^2.0.0" usage="Test runner for unit and integration tests"/>
        <dep name="@testing-library/react" version="^16.0.0" usage="React Testing Library for component testing"/>
        <dep name="@testing-library/jest-dom" version="^6.0.0" usage="Custom jest matchers for DOM testing"/>
        <dep name="@testing-library/user-event" version="^14.0.0" usage="User interaction simulation for tests"/>
        <dep name="jsdom" version="^25.0.0" usage="DOM implementation for Node.js testing"/>
        <dep name="@playwright/test" version="TBD" usage="E2E testing framework for web (to be installed)"/>
      </web>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="dependency">Story 2-1 (Host Event Creation), Story 2-2 (RSVP & Deposit), Story 2-3 (QR Check-In), Story 2-4 (Event Browse), Story 2-5 (Reminders & Cancellation) must be complete. Tests validate integration of these features. Uses existing MockEventService and MockPaymentService.</constraint>
    <constraint type="test-pyramid">Test pyramid: 70% unit tests (service layer, utilities, hooks), 20% integration tests (component + state + service), 10% E2E tests (critical user journeys). Integration tests mock external services. E2E tests use real components with mock backend APIs.</constraint>
    <constraint type="coverage-targets">Coverage thresholds: 70% branches, 70% functions, 70% lines, 70% statements across all packages. Mobile: jest.config.js enforces thresholds. Web: vitest.config.ts enforces thresholds. CI must pass coverage checks to merge.</constraint>
    <constraint type="ci-flags">Always run tests with CI flags: mobile/shared use jest --ci --passWithNoTests --maxWorkers=2. Web uses vitest run (--run flag). Never run in watch mode in CI. Tests must not hang or require manual intervention.</constraint>
    <constraint type="detox-setup">Mobile E2E requires Detox configuration: .detoxrc.js with apps (ios.debug) and devices (simulator). Build app before tests: npm run test:e2e:build:ios. Run tests: npm run test:e2e:ios. Tests in mobile/e2e/ directory. Detox installed: detox@^20.45.1, detox-cli@^20.0.0.</constraint>
    <constraint type="playwright-setup">Web E2E requires Playwright installation and configuration: playwright.config.ts with baseURL (http://localhost:5173), browsers (chromium, firefox, webkit), headless mode. Install: npm install -D @playwright/test. Tests in web/e2e/ directory. Run: npx playwright test.</constraint>
    <constraint type="mock-services">Integration tests use MockEventService and MockPaymentService from shared/services/mock/. Mock services implement same interface as real services. Pre-populated test data. Simulates network delays and error scenarios. Reset method for test isolation.</constraint>
    <constraint type="test-fixtures">E2E tests require test fixtures: mock events (free, deposit, private), mock payment methods (test cards), test users with RSVPs. Fixtures in mobile/e2e/fixtures/ and web/e2e/fixtures/. Load fixtures before test suite. Clean up after tests.</constraint>
    <constraint type="cross-platform">Integration tests must run identically on mobile and web where applicable. Same test scenarios, same assertions. Platform-specific UI differences acceptable, but core logic and state management must match. Shared integration tests in shared/__tests__/integration/.</constraint>
    <constraint type="state-management">Integration tests wrap components with Redux Provider and TanStack QueryClientProvider. Mock store with initial state. Mock QueryClient with default options. Test state transitions and cache updates. Use waitFor for async state updates.</constraint>
    <constraint type="error-scenarios">Integration and E2E tests must cover error scenarios: network failures (simulate offline), capacity conflicts (409), payment failures (card declined), server errors (500), timeouts (>10s), invalid tokens. Verify error messages displayed to user. Verify retry functionality.</constraint>
    <constraint type="performance">E2E tests should complete within reasonable time: Mobile E2E <5min per test suite. Web E2E <3min per test suite. Use headless browsers for CI. Parallelize test execution where possible. Avoid unnecessary waits.</constraint>
  </constraints>

  <interfaces>
    <interface name="MockEventService" kind="class">
      <signature>class MockEventService extends EventService {
  reset(): void
  createEvent(event: CreateEventRequest): Promise&lt;Event&gt;
  createRSVP(request: RSVPRequest): Promise&lt;RSVP&gt;
  cancelRSVP(eventId: string, reason?: string): Promise&lt;void&gt;
  getMyRSVPs(userId: string): Promise&lt;Event[]&gt;
  searchEvents(filters: EventFilterRequest): Promise&lt;EventSearchResult&gt;
  checkIn(request: CheckInRequest): Promise&lt;CheckInResponse&gt;
}</signature>
      <path>shared/services/mock/mockEvents.service.ts</path>
    </interface>
    <interface name="MockPaymentService" kind="class">
      <signature>class MockPaymentService extends PaymentService {
  reset(): void
  authorizeDeposit(request: AuthorizeDepositRequest): Promise&lt;AuthorizeDepositResponse&gt;
  getPaymentMethods(): Promise&lt;PaymentMethod[]&gt;
  addPaymentMethod(request: AddPaymentMethodRequest): Promise&lt;PaymentMethod&gt;
}</signature>
      <path>shared/services/mock/mockPayment.service.ts</path>
    </interface>
    <interface name="renderWithProviders" kind="test helper">
      <signature>function renderWithProviders(
  ui: React.ReactElement,
  options?: {
    initialState?: Partial&lt;RootState&gt;
    store?: AppStore
    queryClient?: QueryClient
  }
): RenderResult</signature>
      <path>shared/test/testUtils.tsx (to be created)</path>
    </interface>
    <interface name="Detox element matchers" kind="test utilities">
      <signature>element(by.id('testID'))
element(by.text('Label'))
element(by.type('RCTTextInput'))
.tap()
.typeText('text')
.scroll(pixels, direction)
expect(element).toBeVisible()
expect(element).toHaveText('text')</signature>
      <path>Detox API - mobile/e2e/</path>
    </interface>
    <interface name="Playwright page methods" kind="test utilities">
      <signature>page.goto(url)
page.click(selector)
page.fill(selector, text)
page.waitForSelector(selector)
expect(page.locator(selector)).toBeVisible()
expect(page.locator(selector)).toHaveText('text')</signature>
      <path>Playwright API - web/e2e/</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Integration tests use Jest + React Testing Library (mobile) and Vitest + React Testing Library (web). Wrap components with renderWithProviders helper (Redux Provider + QueryClientProvider). Mock EventService and PaymentService for API responses. Test complete user flows from action to state update. Verify optimistic updates and rollback on errors. E2E tests use Detox (mobile) and Playwright (web) with real components and mock backend APIs. Test fixtures for mock data. Target 70% unit test coverage, 20% integration coverage, 10% E2E strategic coverage. Always use CI flags: jest --ci --passWithNoTests --maxWorkers=2 (mobile), vitest run (web). Coverage reports in html/lcov formats. Tests must not hang.</standards>
    <locations>
      <location>shared/src/__tests__/integration/rsvp-flow.test.ts - Integration test for free RSVP flow</location>
      <location>shared/src/__tests__/integration/rsvp-deposit-flow.test.ts - Integration test for deposit RSVP flow</location>
      <location>shared/src/__tests__/integration/rsvp-management.test.ts - Integration test for My RSVPs and cancellation</location>
      <location>shared/src/__tests__/integration/private-event-access.test.ts - Integration test for invite token validation</location>
      <location>mobile/src/__tests__/integration/event-discovery.test.tsx - Mobile integration test for event discovery</location>
      <location>mobile/src/__tests__/integration/rsvp-flow.test.tsx - Mobile integration test for RSVP flow with UI</location>
      <location>mobile/e2e/event-discovery.e2e.test.ts - Detox E2E test for event discovery and filtering</location>
      <location>mobile/e2e/rsvp-free-flow.e2e.test.ts - Detox E2E test for free event RSVP</location>
      <location>mobile/e2e/rsvp-deposit-flow.e2e.test.ts - Detox E2E test for deposit event RSVP</location>
      <location>mobile/e2e/event-cancellation.e2e.test.ts - Detox E2E test for cancellation flow</location>
      <location>mobile/e2e/error-scenarios.e2e.test.ts - Detox E2E test for error handling</location>
      <location>web/src/__tests__/integration/event-discovery.test.tsx - Web integration test for event discovery</location>
      <location>web/src/__tests__/integration/rsvp-flow.test.tsx - Web integration test for RSVP flow with UI</location>
      <location>web/e2e/event-discovery.spec.ts - Playwright E2E test for event discovery and filtering</location>
      <location>web/e2e/rsvp-free-flow.spec.ts - Playwright E2E test for free event RSVP</location>
      <location>web/e2e/rsvp-deposit-flow.spec.ts - Playwright E2E test for deposit event RSVP</location>
      <location>web/e2e/event-cancellation.spec.ts - Playwright E2E test for cancellation flow</location>
      <location>web/e2e/error-scenarios.spec.ts - Playwright E2E test for error handling</location>
    </locations>
    <ideas>
      <idea ac="AC1" priority="critical">Integration test free RSVP flow: Create MockEventService with test event (no deposit). Mock Redux store and QueryClient. Render EventDetailScreen wrapped with providers. Simulate tap on "RSVP" button. Verify EventService.createRSVP called with eventId. Verify optimistic update: participant count +1 immediately. Wait for API response. Verify success state: confirmation message displayed, RSVP status updated, event appears in My RSVPs. Test error scenario: Mock 409 capacity conflict, verify rollback: participant count reverts, error message "Event is full" displayed. Test network failure: Mock network error, verify error message "Network error" and retry button. Run on mobile and web.</idea>
      <idea ac="AC2" priority="critical">Integration test deposit RSVP flow: Create MockEventService with deposit event ($5). Create MockPaymentService with test card. Mock Stripe SDK responses. Render EventDetailScreen with providers. Simulate tap "RSVP" button → see payment authorization modal. Select payment method (test card). Verify "We'll authorize $5 as deposit" message displayed. Simulate tap "Confirm Authorization". Verify PaymentService.authorizeDeposit called with amount=500, paymentMethodId. Verify EventService.createRSVP called with paymentMethodId. Wait for responses. Verify success: confirmation "You're registered! Deposit authorized." displayed, RSVP created with depositAuthorized=true. Test payment failure: Mock card declined error, verify error "Card declined. Please try another payment method", verify retry works. Run on mobile and web.</idea>
      <idea ac="AC3" priority="high">Integration test RSVP management: Mock user with 3 RSVPs (1 upcoming, 1 today, 1 past). Render MyRSVPsScreen w      <idea ac="AC3" priority="high">Integration test RSVP management: Mock usVerify each card shows: title, date, location, deposit badge (if deposit), check-in status. Simulate tap on RSVP card. Verify navigation to EventDetailScreen with correct eventId. Return to MyRSVPsScreen. Simulate tap "Cancel RSVP" on upcoming event. Verify confirmation dialog "Cancel your RSVP? You'll lose your spot.". Simulate tap "Yes, Cancel". Verify EventService.cancelRSVP called with eventId. Wait for response. Verify RSVP removed from list (2 remaining). Navigate to event detail. Verify "RSVP" button available (not "You're Registered"), participant count decremented. Test empty state: Mock user with no RSVPs, verify empty state message "You haven't RSVP'd to any events yet". Run on mobile and web.</idea>
      <idea ac="AC4" priority="high">Integration test private event access: Create MockEventService with private event and valid invite token. Mock deep link navigation: gss://event/{eventId}/invite/{token}. Parse deep link in app. Call EventService.validateInviteToken(token). Verify API call with token. Mock success response: { valid: true, eventId }. Render EventDetailScreen with eventId. Verify event detail displayed (title, date, location, "Private Event" badge). Test RSVP flow identical to public event. Test invalid token: Mock validateInviteToken returns { valid: false }. Verify error message "Invalid or expired invite link" displayed. Verify navigation blocked. Test expired token: Mock token with expired timestamp, verify error "Invite link has expired". Run on mobile and web.</idea>
      <idea ac="AC5" priority="critical">Detox E2E test event discovery (mobile): Launch app. Wait for splash screen to disappear. Tap "Events" tab in bottom navigation. Wait for event list to load. Verify at least 1 event card visible with element(by.id('event-card-0')). Verify event card shows title, date, location. Tap map toggle button element(by.id('map-toggle')). Wait for map to load. Verify map visible with element(by.id('event-map')). Verify at least 1 map marker visible. Tap filter icon element(by.id('filter-button')). Wait for filter modal. Select sport filter "Pickleball" by tapping element(by.text('Pickleball')). Tap "Apply Filters" button. Wait for filtered results. Verify only pickleball events displayed. Verify event count updated. Test search: Tap search box, type "Morning", verify matching events displayed. Test empty state: Apply filter with no matches, verify "No events found" message.</idea>
      <idea ac="AC6" priority="critical">Detox E2E test free RSVP flow (mobile): Navigate to Events tab. Tap first free event card (depositAmount=0) element(by.id('event-card-free')). Wait for event detail screen. Verify event info: element(by.id('event-title')).toHaveText('Morning Pickleball'), element(by.id('event-date')).toBeVisible(), element(by.id('event-location')).toBeVisible(), element(by.id('participant-count')).toHaveText('3/8'). Tap "RSVP" button element(by.id('rsvp-button')). Wait for confirmation screen. Verify success message element(by.text("You're registered)).toBeVisible(). Tap "View My RSVPs" button. Wait for My RSVPs screen. Verify event displayed in list element(by.id('rsvp-card-0')).toBeVisible(). Force quit app: device.terminateApp(). Relaunch app: device.launchApp(). Navigate to My RSVPs. Verify event still displayed (persistence). Return to event detail. Verify participant count updated to '4/8'.</idea>
      <idea ac="AC7" priority="critical">Detox E2E test deposit RSVP flow (mobile): Navigate to Events tab. Tap deposit event card element(by.id('event-card-deposit')). Wait for event detail. Verify deposit amount element(by.text('$5 deposit')).toBeVisible(). Tap "RSVP" button. Wait for payment authorization modal element(by.id('payment-auth-modal')).toBeVisible(). Verify "We'll authorize $5 as deposit" message. Select payment method by tapping element(by.id('payment-method-0')). Tap "Confirm Authorization" button element(by.id('confirm-auth-button')). Wait for authorization processing. Wait for success confirmation element(by.text('Deposit authorized')).toBeVisible(). Tap "Done" button. Navigate to My RSVPs. Verify event displayed with deposit badge element(by.id('deposit-badge')).toBeVisible(). Test payment error: Tap another deposit event, attempt RSVP, mock card decline, verify error element(by.text('Card declined')).toBeVisible(), tap "Retry", select different card, verify success.</idea>
      <idea ac="AC8" priority="critical">Playwright E2E test event discovery (web): Navigate to http://localhost:5173/events. Wait for page load: await page.waitForSelector('[data-testid="event-list"]'). Verify event cards visible: expect(page.locator('[data-testid="event-card"]')).toHaveCount(greaterThan(0)). Click map toggle: await page.click('[data-testid="map-toggle"]'). Wait for map: await page.waitForSelector('[data-testid="event-map"]'). Verify map markers visible. Click filter dropdown: await page.click('[data-testid="filter-button"]'). Select sport "Pickleball": await page.click('text=Pickleball'). Verify filtered results. Test search: await page.fill('[data-testid="search-input"]', 'Morning'). Verify matching events displayed. Test filter persistence: Navigate to /profile, return to /events, verify filters still applied. Test empty state: Apply filter with no matches, verify "No events found" message visible.</idea>
      <idea ac="AC9" priority="critical">Playwright E2E test free RSVP flow (web): Navigate to /events. Click first free event card: await page.click('[data-testid="event-card"]:first-child'). Wait for event detail page: await page.waitForURL(/\/events\/event-\d+/). Verify event info visible: title, date, location, capacity. Click "RSVP" button: await page.click('[data-testid="rsvp-button"]'). Wait for confirmation modal: await page.waitForSelector('[data-testid="rsvp-success-modal"]'). Verify success message: expect(page.locator('text=You're registered!')).toBeVisible(). Close modal: await page.click('[data-testid="close-modal"]'). Verify "You're Registered" chip visible. Navigate to /my-rsvps. Verify event in list: expect(page.locator('[data-testid="rsvp-card"]').first()).toBeVisible(). Test cancel RSVP: Click "Cancel RSVP" button, verify confirmation dialog, click "Yes, Cancel", wait for removal, verify event removed from list. Return to event detail, verify "RSVP" button available again, participant count decremented.</idea>
      <idea ac="AC10" priority="critical">Playwright E2E test deposit RSVP flow (web): Navigate to /events. Click deposit event card with data-depositAmount="500". Wait for event detail page. Verify deposit amount visible: expect(page.locator('text=$5 deposit')).toBeVisible(). Click "RSVP" button. Wait for payment authorization modal: await page.waitForSelector('[data-testid="payment-auth-modal"]'). Verify "We'll authorize $5 as deposit" message. Select payment method: await page.click('[data-testid="payment-method-0"]'). Click "Confirm Authorization": await page.click('[data-testid="confirm-auth-button"]'). Wait for processing spinner. Wait for success modal: expect(page.locator('text=Deposit authorized')).toBeVisible(). Close modal. Verify "You're Registered" chip with deposit icon. Navigate to /my-rsvps. Verify event displayed with deposit badge: expect(page.locator('[data-testid="deposit-badge"]')).toBeVisible() with text "$5 deposit".</idea>
      <idea ac="AC11" priority="high">E2E test cancellation flow (mobile and web): Navigate to My RSVPs. Select upcoming event with RSVP. Mobile: Tap "Cancel RSVP" button element(by.id('cancel-rsvp-button')). Web: await page.click('[data-testid="cancel-rsvp-button"]'). Verify confirmation dialog: "Cancel your RSVP? You'll lose your spot.". Confirm cancellation. Wait for processing. Verify success message "RSVP cancelled". Verify event removed from My RSVPs list. Navigate to event detail. Verify "RSVP" button available (no longer registered). Verify participant count decremented. Test deposit cancellation: Cancel RSVP for deposit event within cutoff window (<24h). Verify warning "Cancelling within cutoff window may forfeit deposit". Confirm. Verify deposit authorization voided, no refund. Test outside cutoff: Cancel >24h before event, verify deposit voided with no penalty message.</idea>
      <idea ac="AC12" priority="high">E2E test error scenarios (mobile and web): Test network failure during RSVP: Navigate to event detail. Disable network (simulate airplane mode). Attempt RSVP. Verify error message "Network error. Check your connection and try again". Re-enable network. Tap/click retry. Verify success. Test capacity conflict: Mock backend returns 409 Conflict. Attempt RSVP. Verify error "Event is full". Return to list. Verify event shows "Full" badge. Test payment authorization failure: Mock card declined (Stripe error). Attempt deposit RSVP. Verify error "Card declined. Please try another payment method". Select different card. Retry. Verify success. Test server error (500): Mock backend error. Attempt RSVP. Verify error "Something went wrong. Please try again later". Verify retry button works. Test timeout: Mock slow API response (>10s). Attempt RSVP. Verify loading spinner. Wait for timeout. Verify timeout error. Verify retry works.</idea>
      <idea ac="AC1-AC12" priority="medium">E2E test fixtures setup: Create mock event fixtures in mobile/e2e/fixtures/events.json and web/e2e/fixtures/events.json: free event (no deposit), deposit event ($5), private event (with token), full event (capacity reached). Create mock payment method fixtures: valid card (Visa 4242), declined card (error trigger), expired card. Create mock user fixtures: user with RSVPs, user without RSVPs, host user. Load fixtures before each test suite. Clean up after tests. Reset mock service state between tests.</idea>
      <idea ac="AC5-AC12" priority="high">CI/CD integration: Configure GitHub Actions workflow for E2E tests. Mobile: Build iOS app in CI (npm run test:e2e:build:ios), run Detox tests in headless simulator (npm run test:e2e:ios --headless). Web: Start dev server (npm run dev --port 5173), run Playwright tests in headless browsers (npx playwright test --project=chromium). Generate coverage reports (html, lcov). Upload coverage to Codecov. Fail CI if coverage below 70%. Parallelize tests where possible. Set timeouts: mobile E2E 10min, web E2E 5min. Retry flaky tests once. Archive test artifacts (screenshots, videos) on failure.</idea>
    </ideas>
  </tests>
</story-context>
